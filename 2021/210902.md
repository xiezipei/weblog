# Taro 3 文档学习

[toc]

## 目标

2021.09.30：

- [x] 了解 Taro 技术框架
- [ ] Taro 3.x 渐进式入门教程
  - [x] 环境准备
  - [ ] 基础教程
  - [ ] 项目进阶与优化
  - [ ] 多端开发

## 资源

文档学习：

- [Taro 介绍 \| Taro 文档](https://docs.taro.zone/docs/README)
- [渐进式入门教程 \| Taro 文档](https://docs.taro.zone/docs/guide)

## 输出

### 环境准备

- [x] 安装 Node.js V12
- [x] 安装 Taro CLI 

目前 Taro 仅提供一种开发方式：安装 Taro 命名行工具（Taro CLI）进行开发。

Taro CLI 依赖 Node.js 环境，推荐安装 LTS 版本 **V12**。

安装 Taro CLI：

```sh
npm i -g @tarojs/cli
```

验证安装成功：

![Xnip2021-09-30_15-54-24](https://tva1.sinaimg.cn/large/008i3skNgy1guypineqw7j60bl07naa202.jpg)

### 基础教程

#### 项目初始化

使用 `taro -help` 查到初始化项目命名：

```sh
# 初始化一个新项目 HelloTaro
taro init HelloTaro
```

![Xnip2021-09-30_16-01-58](https://tva1.sinaimg.cn/large/008i3skNly1guyprsxvp4j60nn0jxacy02.jpg)

安装成功：

![Xnip2021-09-30_16-06-30.png](https://tva1.sinaimg.cn/large/008i3skNgy1guypvj4f6lj60lw0bfjss02.jpg)

打开项目：

![Xnip2021-09-30_16-13-30](https://tva1.sinaimg.cn/large/008i3skNgy1guyq3f7xgxj60x10mn77p02.jpg)

```sh
├── babel.config.js             # Babel 配置
├── .eslintrc.js                # ESLint 配置
├── config                      # 编译配置目录
│   ├── dev.js                  # 开发模式配置
│   ├── index.js                # 默认配置
│   └── prod.js                 # 生产模式配置
├── package.json                # Node.js manifest
├── dist                        # 打包目录
├── project.config.json         # 小程序项目配置
├── src # 源码目录
│   ├── app.config.js           # 全局配置
│   ├── app.css                 # 全局 CSS
│   ├── app.js                  # 入口组件
│   ├── index.html              # H5 入口 HTML
│   └── pages                   # 页面组件
│       └── index
│           ├── index.config.js # 页面配置
│           ├── index.css       # 页面 CSS
│           └── index.jsx       # 页面组件，如果是 Vue 项目，此文件为 index.vue
```

#### 运行项目

```json
"scripts": {
    "build:weapp": "taro build --type weapp",
    "build:swan": "taro build --type swan",
    "build:alipay": "taro build --type alipay",
    "build:tt": "taro build --type tt",
    "build:h5": "taro build --type h5",
    "build:rn": "taro build --type rn",
    "build:qq": "taro build --type qq",
    "build:quickapp": "taro build --type quickapp",
    "dev:weapp": "npm run build:weapp -- --watch",
    "dev:swan": "npm run build:swan -- --watch",
    "dev:alipay": "npm run build:alipay -- --watch",
    "dev:tt": "npm run build:tt -- --watch",
    "dev:h5": "npm run build:h5 -- --watch",
    "dev:rn": "npm run build:rn -- --watch",
    "dev:qq": "npm run build:qq -- --watch",
    "dev:quickapp": "npm run build:quickapp -- --watch"
},
```

执行 `dev:h5`，项目成功运行：

![Xnip2021-09-30_16-34-57](https://tva1.sinaimg.cn/large/008i3skNly1guyqp179buj60at0gzmxa02.jpg)

#### 入口组件

> Taro 的入口组件和全局配置规范是基于微信小程序而制定的，并对全平台进行统一。

每一个 Taro 项目都有一个入口组件和一个入口配置，我们可以在入口组件中设置全局状态/全局生命周期。

每一个入口组件（例如 `app.js`）总是伴随一个全局配置文件（例如 `app.config.js`），我们可以在全局配置文件中设置页面组件的路径、全局窗口、路由等信息。

`app.js`

```ts
import Vue from 'vue'
import './app.css'

const App = {
  render(h) {
    // this.$slots.default 是将要会渲染的页面
    return h('block', this.$slots.default)
  }
}

export default App
```

`app.config.js`

```ts
export default {
  pages: [
    'pages/index/index'
  ]
}
```

#### 页面组件

页面组件是每一项路由将会渲染的页面，Taro 的页面默认放在 `src/pages` 中，每一个 Taro 项目至少有一个页面组件。在我们生成的项目中有一个页面组件：`src/pages/index/index`，对应的就是全局配置文件 `app.config.ts` 中 `pages` 字段当中的值。

一个简单的页面组件如下：

```html
<template>
  <view>
    {{ msg }}
  </view>
</template>

<script>

export default {
  data() {
    return {
      msg: 'Hello World!'
    };
  },
  onReady () {
    console.log('onReady')
  }
};
</script>
```

> 注：打开 `.vue` 文件 vscode 会提示安装 `Vetur` 插件：
> ![Xnip2021-09-30_16-55-23](https://tva1.sinaimg.cn/large/008i3skNly1guyr9u3i8xj60s80a2q3k02.jpg)

#### 自定义组件

假如我们要实现一个首页，其功能是把论坛最新的帖子展示出来：

```
- index.vue
    - thread_list.vue
        - threadd.vue
```

说明：

1. Taro 应用中发送请求是 `Taro.request()`。 和页面配置、全局配置一样，Taro 的 API 规范也是基于 **微信小程序** 而制定的，并对全平台进行统一。 你可以通过在 API 文档 找到所有 API。👉 [API 说明 \| Taro 文档](https://docs.taro.zone/docs/apis/about/desc)
2. Taro 文档的跨平台组件库 包含了所有组件参数和用法。但目前组件库文档中的参数和组件名都是针对 React 的（除了 React 的点击事件是 onClick 之外）。 对于 Vue 而言，组件名和组件参数都采用短横线风格（kebab-case）的命名方式（如：`<picker-view indicator-class="myclass" />`。👉 [组件库说明 \| Taro 文档](https://docs.taro.zone/docs/components-desc)

`src/pages/index/index.vue`

```html
<template>
  <view class='index'>
    <thread-list
      :threads="threads"
      :loading="loading"
    />
  </view>
</template>

<script>
import Vue from 'vue'
import Taro from '@tarojs/taro'
import api from '../../utils/api'
import ThreadList from '../../components/thread_list.vue'

export default {
  components: {
    'thread-list': ThreadList
  },

  data () {
    return {
      loading: true,
      threads: []
    }
  },

  async created() {
    try {
      const res = await Taro.request({
        url: api.getLatestTopic()
      })
      this.loading = false
      this.threads = res.data
    } catch (error) {
      Taro.showToast({
        title: '载入远程数据错误'
      })
    }
  }
}
</script>
```

`src/components/thread_list.vue`

```html
<template>
  <view className='thread-list'>
    <loading v-if="loading" />
    <thread
      v-else
      v-for="t in threads"
      :key="t.id"
      :node="t.node"
      :title="t.title"
      :last_modified="t.last_modified"
      :replies="t.replies"
      :tid="t.id"
      :member="t.member"
    />
  </view>
</template>

<script >
import Vue from 'vue'
import Loading from './loading.vue'
import Thread from './thread.vue'
export default {
  components: {
    'loading': Loading,
    'thread': Thread
  },
  props: {
    threads: {
      type: Array,
      default: []
    },
    loading: {
      type: Boolean,
      default: true
    }
  }
}
</script>
```

`src/components/thread.vue`

```html
<template>
  <view class='thread' @tap="handleNavigate">
    <view class='info'>
      <view>
        <image :src="member.avatar_large | url" class='avatar' />
      </view>
      <view class='middle'>
        <view :class="usernameCls">
            {{member.username}}
        </view>
        <view class='replies'>
          <text class='mr10'>{{time}}</text>
          <text>评论 {{replies}}</text>
        </view>
      </view>
      <view class='node'>
        <text class='tag'>{{node.title}}</Text>
      </view>
    </view>
    <text class='title'>{{title}}</text>
  </view>
</template>

<script>
import Vue from 'vue'
import { eventCenter } from '@tarojs/taro'
import Taro from '@tarojs/taro'
import { timeagoInst, Thread_DETAIL_NAVIGATE } from '../utils'
import './thread.css'
export default {
  props: ['title', 'member', 'last_modified', 'replies', 'node', 'not_navi', 'tid'],
  computed: {
    time () {
      return timeagoInst.format(this.last_modified * 1000, 'zh')
    },
    usernameCls () {
      return `author ${this.not_navi ? 'bold' : ''}`
    }
  },
  filters: {
    url (val) {
      return 'https:' + val
    }
  },
  methods: {
    handleNavigate () {
      const { tid, not_navi } = this.$props
      if (not_navi) {
        return
      }
      eventCenter.trigger(Thread_DETAIL_NAVIGATE, this.$props)
      // 跳转到帖子详情
      Taro.navigateTo({
        url: '/pages/thread_detail/thread_detail'
      })
    }
  }
}
</script>
```

#### 路由与 Tabbar