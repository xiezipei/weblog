# Taro 3 æ–‡æ¡£å­¦ä¹ 

[toc]

## ç›®æ ‡

2021.09.30ï¼š

- [x] äº†è§£ Taro æŠ€æœ¯æ¡†æ¶
- [ ] Taro 3.x æ¸è¿›å¼å…¥é—¨æ•™ç¨‹
  - [x] ç¯å¢ƒå‡†å¤‡
  - [ ] åŸºç¡€æ•™ç¨‹
  - [ ] é¡¹ç›®è¿›é˜¶ä¸ä¼˜åŒ–
  - [ ] å¤šç«¯å¼€å‘

## èµ„æº

æ–‡æ¡£å­¦ä¹ ï¼š

- [Taro ä»‹ç» \| Taro æ–‡æ¡£](https://docs.taro.zone/docs/README)
- [æ¸è¿›å¼å…¥é—¨æ•™ç¨‹ \| Taro æ–‡æ¡£](https://docs.taro.zone/docs/guide)

## è¾“å‡º

### ç¯å¢ƒå‡†å¤‡

- [x] å®‰è£… Node.js V12
- [x] å®‰è£… Taro CLI 

ç›®å‰ Taro ä»…æä¾›ä¸€ç§å¼€å‘æ–¹å¼ï¼šå®‰è£… Taro å‘½åè¡Œå·¥å…·ï¼ˆTaro CLIï¼‰è¿›è¡Œå¼€å‘ã€‚

Taro CLI ä¾èµ– Node.js ç¯å¢ƒï¼Œæ¨èå®‰è£… LTS ç‰ˆæœ¬ **V12**ã€‚

å®‰è£… Taro CLIï¼š

```sh
npm i -g @tarojs/cli
```

éªŒè¯å®‰è£…æˆåŠŸï¼š

![Xnip2021-09-30_15-54-24](https://tva1.sinaimg.cn/large/008i3skNgy1guypineqw7j60bl07naa202.jpg)

### åŸºç¡€æ•™ç¨‹

#### é¡¹ç›®åˆå§‹åŒ–

ä½¿ç”¨ `taro -help` æŸ¥åˆ°åˆå§‹åŒ–é¡¹ç›®å‘½åï¼š

```sh
# åˆå§‹åŒ–ä¸€ä¸ªæ–°é¡¹ç›® HelloTaro
taro init HelloTaro
```

![Xnip2021-09-30_16-01-58](https://tva1.sinaimg.cn/large/008i3skNly1guyprsxvp4j60nn0jxacy02.jpg)

å®‰è£…æˆåŠŸï¼š

![Xnip2021-09-30_16-06-30.png](https://tva1.sinaimg.cn/large/008i3skNgy1guypvj4f6lj60lw0bfjss02.jpg)

æ‰“å¼€é¡¹ç›®ï¼š

![Xnip2021-09-30_16-13-30](https://tva1.sinaimg.cn/large/008i3skNgy1guyq3f7xgxj60x10mn77p02.jpg)

```sh
â”œâ”€â”€ babel.config.js             # Babel é…ç½®
â”œâ”€â”€ .eslintrc.js                # ESLint é…ç½®
â”œâ”€â”€ config                      # ç¼–è¯‘é…ç½®ç›®å½•
â”‚   â”œâ”€â”€ dev.js                  # å¼€å‘æ¨¡å¼é…ç½®
â”‚   â”œâ”€â”€ index.js                # é»˜è®¤é…ç½®
â”‚   â””â”€â”€ prod.js                 # ç”Ÿäº§æ¨¡å¼é…ç½®
â”œâ”€â”€ package.json                # Node.js manifest
â”œâ”€â”€ dist                        # æ‰“åŒ…ç›®å½•
â”œâ”€â”€ project.config.json         # å°ç¨‹åºé¡¹ç›®é…ç½®
â”œâ”€â”€ src # æºç ç›®å½•
â”‚   â”œâ”€â”€ app.config.js           # å…¨å±€é…ç½®
â”‚   â”œâ”€â”€ app.css                 # å…¨å±€ CSS
â”‚   â”œâ”€â”€ app.js                  # å…¥å£ç»„ä»¶
â”‚   â”œâ”€â”€ index.html              # H5 å…¥å£ HTML
â”‚   â””â”€â”€ pages                   # é¡µé¢ç»„ä»¶
â”‚       â””â”€â”€ index
â”‚           â”œâ”€â”€ index.config.js # é¡µé¢é…ç½®
â”‚           â”œâ”€â”€ index.css       # é¡µé¢ CSS
â”‚           â””â”€â”€ index.jsx       # é¡µé¢ç»„ä»¶ï¼Œå¦‚æœæ˜¯ Vue é¡¹ç›®ï¼Œæ­¤æ–‡ä»¶ä¸º index.vue
```

#### è¿è¡Œé¡¹ç›®

```json
"scripts": {
    "build:weapp": "taro build --type weapp",
    "build:swan": "taro build --type swan",
    "build:alipay": "taro build --type alipay",
    "build:tt": "taro build --type tt",
    "build:h5": "taro build --type h5",
    "build:rn": "taro build --type rn",
    "build:qq": "taro build --type qq",
    "build:quickapp": "taro build --type quickapp",
    "dev:weapp": "npm run build:weapp -- --watch",
    "dev:swan": "npm run build:swan -- --watch",
    "dev:alipay": "npm run build:alipay -- --watch",
    "dev:tt": "npm run build:tt -- --watch",
    "dev:h5": "npm run build:h5 -- --watch",
    "dev:rn": "npm run build:rn -- --watch",
    "dev:qq": "npm run build:qq -- --watch",
    "dev:quickapp": "npm run build:quickapp -- --watch"
},
```

æ‰§è¡Œ `dev:h5`ï¼Œé¡¹ç›®æˆåŠŸè¿è¡Œï¼š

![Xnip2021-09-30_16-34-57](https://tva1.sinaimg.cn/large/008i3skNly1guyqp179buj60at0gzmxa02.jpg)

#### å…¥å£ç»„ä»¶

> Taro çš„å…¥å£ç»„ä»¶å’Œå…¨å±€é…ç½®è§„èŒƒæ˜¯åŸºäºå¾®ä¿¡å°ç¨‹åºè€Œåˆ¶å®šçš„ï¼Œå¹¶å¯¹å…¨å¹³å°è¿›è¡Œç»Ÿä¸€ã€‚

æ¯ä¸€ä¸ª Taro é¡¹ç›®éƒ½æœ‰ä¸€ä¸ªå…¥å£ç»„ä»¶å’Œä¸€ä¸ªå…¥å£é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¥å£ç»„ä»¶ä¸­è®¾ç½®å…¨å±€çŠ¶æ€/å…¨å±€ç”Ÿå‘½å‘¨æœŸã€‚

æ¯ä¸€ä¸ªå…¥å£ç»„ä»¶ï¼ˆä¾‹å¦‚ `app.js`ï¼‰æ€»æ˜¯ä¼´éšä¸€ä¸ªå…¨å±€é…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚ `app.config.js`ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­è®¾ç½®é¡µé¢ç»„ä»¶çš„è·¯å¾„ã€å…¨å±€çª—å£ã€è·¯ç”±ç­‰ä¿¡æ¯ã€‚

`app.js`

```ts
import Vue from 'vue'
import './app.css'

const App = {
  render(h) {
    // this.$slots.default æ˜¯å°†è¦ä¼šæ¸²æŸ“çš„é¡µé¢
    return h('block', this.$slots.default)
  }
}

export default App
```

`app.config.js`

```ts
export default {
  pages: [
    'pages/index/index'
  ]
}
```

#### é¡µé¢ç»„ä»¶

é¡µé¢ç»„ä»¶æ˜¯æ¯ä¸€é¡¹è·¯ç”±å°†ä¼šæ¸²æŸ“çš„é¡µé¢ï¼ŒTaro çš„é¡µé¢é»˜è®¤æ”¾åœ¨ `src/pages` ä¸­ï¼Œæ¯ä¸€ä¸ª Taro é¡¹ç›®è‡³å°‘æœ‰ä¸€ä¸ªé¡µé¢ç»„ä»¶ã€‚åœ¨æˆ‘ä»¬ç”Ÿæˆçš„é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªé¡µé¢ç»„ä»¶ï¼š`src/pages/index/index`ï¼Œå¯¹åº”çš„å°±æ˜¯å…¨å±€é…ç½®æ–‡ä»¶ `app.config.ts` ä¸­ `pages` å­—æ®µå½“ä¸­çš„å€¼ã€‚

ä¸€ä¸ªç®€å•çš„é¡µé¢ç»„ä»¶å¦‚ä¸‹ï¼š

```html
<template>
  <view>
    {{ msg }}
  </view>
</template>

<script>

export default {
  data() {
    return {
      msg: 'Hello World!'
    };
  },
  onReady () {
    console.log('onReady')
  }
};
</script>
```

> æ³¨ï¼šæ‰“å¼€ `.vue` æ–‡ä»¶ vscode ä¼šæç¤ºå®‰è£… `Vetur` æ’ä»¶ï¼š
> ![Xnip2021-09-30_16-55-23](https://tva1.sinaimg.cn/large/008i3skNly1guyr9u3i8xj60s80a2q3k02.jpg)

#### è‡ªå®šä¹‰ç»„ä»¶

å‡å¦‚æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªé¦–é¡µï¼Œå…¶åŠŸèƒ½æ˜¯æŠŠè®ºå›æœ€æ–°çš„å¸–å­å±•ç¤ºå‡ºæ¥ï¼š

```
- index.vue
    - thread_list.vue
        - threadd.vue
```

è¯´æ˜ï¼š

1. Taro åº”ç”¨ä¸­å‘é€è¯·æ±‚æ˜¯ `Taro.request()`ã€‚ å’Œé¡µé¢é…ç½®ã€å…¨å±€é…ç½®ä¸€æ ·ï¼ŒTaro çš„ API è§„èŒƒä¹Ÿæ˜¯åŸºäº **å¾®ä¿¡å°ç¨‹åº** è€Œåˆ¶å®šçš„ï¼Œå¹¶å¯¹å…¨å¹³å°è¿›è¡Œç»Ÿä¸€ã€‚ ä½ å¯ä»¥é€šè¿‡åœ¨ API æ–‡æ¡£ æ‰¾åˆ°æ‰€æœ‰ APIã€‚ğŸ‘‰ [API è¯´æ˜ \| Taro æ–‡æ¡£](https://docs.taro.zone/docs/apis/about/desc)
2. Taro æ–‡æ¡£çš„è·¨å¹³å°ç»„ä»¶åº“ åŒ…å«äº†æ‰€æœ‰ç»„ä»¶å‚æ•°å’Œç”¨æ³•ã€‚ä½†ç›®å‰ç»„ä»¶åº“æ–‡æ¡£ä¸­çš„å‚æ•°å’Œç»„ä»¶åéƒ½æ˜¯é’ˆå¯¹ React çš„ï¼ˆé™¤äº† React çš„ç‚¹å‡»äº‹ä»¶æ˜¯ onClick ä¹‹å¤–ï¼‰ã€‚ å¯¹äº Vue è€Œè¨€ï¼Œç»„ä»¶åå’Œç»„ä»¶å‚æ•°éƒ½é‡‡ç”¨çŸ­æ¨ªçº¿é£æ ¼ï¼ˆkebab-caseï¼‰çš„å‘½åæ–¹å¼ï¼ˆå¦‚ï¼š`<picker-view indicator-class="myclass" />`ã€‚ğŸ‘‰ [ç»„ä»¶åº“è¯´æ˜ \| Taro æ–‡æ¡£](https://docs.taro.zone/docs/components-desc)

`src/pages/index/index.vue`

```html
<template>
  <view class='index'>
    <thread-list
      :threads="threads"
      :loading="loading"
    />
  </view>
</template>

<script>
import Vue from 'vue'
import Taro from '@tarojs/taro'
import api from '../../utils/api'
import ThreadList from '../../components/thread_list.vue'

export default {
  components: {
    'thread-list': ThreadList
  },

  data () {
    return {
      loading: true,
      threads: []
    }
  },

  async created() {
    try {
      const res = await Taro.request({
        url: api.getLatestTopic()
      })
      this.loading = false
      this.threads = res.data
    } catch (error) {
      Taro.showToast({
        title: 'è½½å…¥è¿œç¨‹æ•°æ®é”™è¯¯'
      })
    }
  }
}
</script>
```

`src/components/thread_list.vue`

```html
<template>
  <view className='thread-list'>
    <loading v-if="loading" />
    <thread
      v-else
      v-for="t in threads"
      :key="t.id"
      :node="t.node"
      :title="t.title"
      :last_modified="t.last_modified"
      :replies="t.replies"
      :tid="t.id"
      :member="t.member"
    />
  </view>
</template>

<script >
import Vue from 'vue'
import Loading from './loading.vue'
import Thread from './thread.vue'
export default {
  components: {
    'loading': Loading,
    'thread': Thread
  },
  props: {
    threads: {
      type: Array,
      default: []
    },
    loading: {
      type: Boolean,
      default: true
    }
  }
}
</script>
```

`src/components/thread.vue`

```html
<template>
  <view class='thread' @tap="handleNavigate">
    <view class='info'>
      <view>
        <image :src="member.avatar_large | url" class='avatar' />
      </view>
      <view class='middle'>
        <view :class="usernameCls">
            {{member.username}}
        </view>
        <view class='replies'>
          <text class='mr10'>{{time}}</text>
          <text>è¯„è®º {{replies}}</text>
        </view>
      </view>
      <view class='node'>
        <text class='tag'>{{node.title}}</Text>
      </view>
    </view>
    <text class='title'>{{title}}</text>
  </view>
</template>

<script>
import Vue from 'vue'
import { eventCenter } from '@tarojs/taro'
import Taro from '@tarojs/taro'
import { timeagoInst, Thread_DETAIL_NAVIGATE } from '../utils'
import './thread.css'
export default {
  props: ['title', 'member', 'last_modified', 'replies', 'node', 'not_navi', 'tid'],
  computed: {
    time () {
      return timeagoInst.format(this.last_modified * 1000, 'zh')
    },
    usernameCls () {
      return `author ${this.not_navi ? 'bold' : ''}`
    }
  },
  filters: {
    url (val) {
      return 'https:' + val
    }
  },
  methods: {
    handleNavigate () {
      const { tid, not_navi } = this.$props
      if (not_navi) {
        return
      }
      eventCenter.trigger(Thread_DETAIL_NAVIGATE, this.$props)
      // è·³è½¬åˆ°å¸–å­è¯¦æƒ…
      Taro.navigateTo({
        url: '/pages/thread_detail/thread_detail'
      })
    }
  }
}
</script>
```

#### è·¯ç”±ä¸ Tabbar