# 进击的 TypeScript（3）- 接口、类、函数

## 1. 接口

> 在 TS 中，接口的作用就是为类型命名和为你的代码或第三方代码定义契约。[^1]

### 1.1 使用示例

```ts
interface User {    // 定义user接口类型
    name: string,
    age: number,
}
// const getUserName = (user) => user.name;  // Error: 参数“user”隐式具有“any”类型
const getUserName = (user: User) => user.name;  // OK
console.log(getUserName({ name: 'Tony', age: 18 }));    // OK
```

### 1.2 可选属性

```ts
interface User {
    name: string,
    age?: number,   // 可选属性
}
const getUserName = (user: User) => user.name;  // OK
console.log(getUserName({ name: 'Tony' }));    // OK
```

### 1.3 只读属性

```ts
interface User {
    name: string,
    readonly age: number,   // 只读属性
}
const getUserName = (user: User) => user.age++;  // Error: 无法分配到 "age" ，因为它是只读属性。
```


### 1.4 函数类型

方式 1 - 直接在内部描述函数

```ts
interface User {
    name: string,
    greet: (username: string) => string
}
const user: User = {
    name: 'Tony',
    greet: (username: string) => `Hi~${username}!`
}
console.log(user.greet('Jack'));    // OK
```

方式 2 - 先用接口描述函数类型，再在内部使用该函数类型接口

```ts
interface Greet {   // here
    (username: string) : string
}

interface User {
    name: string,
    greet: Greet    // here
}
const user: User = {
    name: 'Tony',
    greet: (username: string) => `Hi~${username}!`
}
console.log(user.greet('Jack'));    // OK
```

### 1.5 可索引类型

可索引类型具有一个索引签名，它描述了对象索引的类型，还有相应的索引返回值类型。

```ts
interface Email {
    [name: string]: string  // 索引签名
}

interface User {
    name: string,
    age?: number,
    readonly isMale: boolean,
    say: () => string,
    email: Email    // here
}

const user: User = {
    name: 'Tony',
    age: 18,
    isMale: true,
    say: Function,
    email: {
        qq: 'tony@qq.com',
        foxmail: 'tony@foxmail.com',
        gmail: 'tony@gmail.com',
    }
}
```

### 1.6 属性检查

示例：

```ts
interface SquareConfig {
    color?: string;
    width?: number;
}

function createSquare(config: SquareConfig) : { color: string; area : number } {
    return {
        color: config.color ? config.color : 'white',
        area: config.width ? config.width * config.width : 0,
    }
}

let square = createSquare({ color: 'green', width: 50 });   // OK
```

但是传参对象出现一个非目标类型属性名 `colour`：

```ts
let square = createSquare({ colour: 'red', width: 100 });    // Error: “colour”中不存在类型“SquareConfig”
```

这时有 3 种处理方式：

1. 使用类型断言
2. 使用字符串索引签名
3. 将字面量赋值给另外一个变量

方法 1：使用类型断言

```ts
let square = createSquare({ colour: 'red', width: 100 } as SquareConfig);   // OK
```

方法 2：使用字符串索引签名（只要新属性不叫color、width, 什么类型也无所谓）

```ts
interface SquareConfig {    // 修改接口
    color?: string;
    width?: number;
    [propName: string]: any;    // here
}
let square = createSquare({ colour: 'red', width: 100 });  // OK
```

方法 3：将字面量赋值给另外一个变量（本质上转化为any类型，不推荐）

```ts
let options: any = { colour: 'red', width: 100 };
let square = createSquare(options); // OK
```

### 1.7 继承接口

和类一样，接口也可以继承（从一个接口里复制成员到另一个接口里）。

```ts
interface User {    // 定义user接口类型
    name: string,
    age: number,
}

interface VipUser extends User {    // 继承单个接口
    color: number
}

interface SuperVipUser extends User, VipUser {  // 继承多个接口
    assistant: string
}
```

## 2. 类

## 3. 函数

## 4. 参考

[^1]: [接口 · TypeScript中文网](https://www.tslang.cn/docs/handbook/interfaces.html)