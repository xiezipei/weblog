# React 学习 - React Hooks

[toc]

## Todo

- [x] 01
- [x] 02
- [x] 03
- [x] 04
- [ ] 05
- [ ] 06
- [ ] 07
- [ ] 08
- [ ] 09
- [ ] 10
- [ ] 11

## 概要信息

- 教程地址：[技术胖\- React Hooks 视频教程](https://jspang.com/detailed?id=50#toc21)
- 代码仓库地址：[xiezipei/react\-demos](https://github.com/xiezipei/react-demos)

## 教程学习

### 1. React Hooks 介绍和环境搭建

React Hooks 介绍：

> 2018 年底 FaceBook 的 React 小组推出 Hooks 以来，所有的 React 的开发者都对它大为赞赏。
> 
> React Hooks 就是 **用函数的形式代替原来的继承类的形式**，并且使用预函数的形式管理 state，有 Hooks 可以不再使用类的形式定义组件了。这时候你的认知也要发生变化了，原来把组件分为有状态组件和无状态组件，有状态组件用类的形式声明，无状态组件用函数的形式声明。那现在所有的组件都可以用函数来声明了。

点击计数小示例的两种写法：

有状态组件写法：

```js
// demo11/src/App.js
import React, { Component } from 'react';

class App extends Component {
    constructor(props) {
        super(props)
        this.state = { count: 0 }
    }
    addCount() {
        this.setState({
            count: this.state.count + 1
        })
    }
    render() { 
        return (
            <div>
                <p>你点击了 { this.state.count } 次。</p>
                <button onClick={ this.addCount.bind(this) }>
                    点击我
                </button>
            </div>
        )
    }
}
 
export default App
```

React Hooks 写法：

```js
// demo11/src/AppByHooks.js
import React, { useState } from 'react';

function AppByHooks() {
    const [ count, setCount ] = useState(0)
    return (
        <div>
            <p>你点击了 { count } 次。</p>
            <button onClick={ () => { setCount(count + 1)} }>
                点击我
            </button>
        </div>
    )
}

export default AppByHooks
```

React Hooks 与有状态组件写法对比：

1. 代码更简洁
2. 干掉了 class 类继承写法，只用 function

### 2. useState 介绍和多状态声明

`useState` 是 react 自带的一个hook函数，它的作用是用来声明状态变量。

从三个方面了解 `useState` 用法：

1. 声明
2. 读取
3. 使用（修改）

#### 2.1 声明

```js
// 数组解构赋值，相当于：
// let _useState = useState(0)
// let count = _useState[0]
// let setCount = _useState[1]
const [ count, setCount ] = useState(0)
```

说明：

1. `userState` 是一个函数，接收的参数是状态的初始值（initial state）
2. `userState` 会返回一个数组，数组第 1 位是当前状态值，第 2 位是改变状态值的方法函数

#### 2.2 读取

读取很简单，因为 `count` 是定义在函数内的变量，在 `JSX` 使用直接加上 `{}` 即可：

```html
<p>你点击了 { count } 次。</p>
```

#### 2.3 使用

直接调用 `setCount` 函数，这个函数接收的参数是修改过的新状态值：

```js
<button onClick={() => {setCount(count+1)}}>click me</button>
```

#### 2.4 多状态声明

因为 useState 每次声明一个状态，如果有多个状态，多次调用即可：

```js
const [ age , setAge ] = useState(18)
const [ sex , setSex ] = useState('male')
const [ work , setWork ] = useState('Programmer')
```

问题：React 是怎么保证这 3 个 useState 找到它自己对应的 state？

- React 是根据 useState 出现的顺序来确定

### 3. useEffect 代替常用生命周期函数

在用 Class 制作组件时，经常会用生命周期函数，来处理一些额外的事情，例如和函数业务主逻辑关联不大，特定时间或事件中执行的动作，比如 Ajax 请求后端数据，添加登录监听和取消登录，手动修改 DOM 等等）。

在 React Hooks 中也需要这样类似的生命周期函数，比如在每次状态（State）更新时执行，它为我们准备了 `useEffect。`

参考 demo11/lifeCycleByHooks.js

```js
useEffect(() => {
    console.log(`useEffect => 你点击了${count}次。`)
})
```

注意：

1. React 首次渲染和之后的每次渲染都会调用一次 `userEffect` 函数，而之前我们要用两个生命周期函数分别表示首次渲染（`componentDidMount`）和更新导致的重新渲染（`componentDidUpdate`）
2. `useEffect` 中定义的函数的执行不会阻碍浏览器更新视图，也就是说函数是异步执行的，而 `componentDidMount` 和 `componentDidUpdate` 中的代码都是同步执行的

### 4. useEffect 实现生命周期函数

在写 React 应用的时候，在组件中经常用到 `componentWillUnmount` 生命周期函数（组件将要被卸载时执行），例如：

- 定时器要清空，避免发生内存泄露
- 登录状态要取消掉，避免下次进入信息出错

所以，当我们用 useEffect 时，应该怎么实现这个生命周期函数？

关键代码：

```js
/** 首页组件 */
function Index() {
    useEffect(() => {   // 副效应
        console.log('进入 Index 页面')
        return () => {  // 解绑副效应
            console.log('离开 Index 页面')
        }
    }, []) // 状态对应的变量，[]表示当数组将被销毁时才进行解绑
    return (   // 渲染
        <h2>Index page.</h2>
    )
}
```

### 5. useContext 让父子组件传值更简单

在用类声明组件时，父子组件的传值是通过组件属性和 `props` 进行的，那现在使用方法 `Function` 来声明组件，已经没有了 `constructor` 构造函数也就没有了props的接收，那父子组件的传值就成了一个问题。

React Hooks 准备了 `useContext`，它可以帮助我们跨域组件层级直接传递变量，实现共享。

注意：`useContext` 和 `redux` 的作用是不同的，一个解决的是 **组件之间值传递的问题**，一个是 **应用中统一管理状态的问题**，但通过和 `useReducer` 的配合使用，可以实现类似 `Redux` 的作用。

`Context` 的作用就是对它所包含的组件树提供全局共享数据的一种技术。

示例代码：

1. 使用 `createContext` 方法生成一个实例，这个实例名字作为组件标签名
2. 其它组件使用 `useContext()` 方法，传入上面实例名字，就可以实现共享数据

```js
import React, { useState, createContext, useContext } from 'react';

const CountContext = createContext()

function Counter() {
    const count = useContext(CountContext)
    return (
        <h2>{count}</h2>
    )
}

function AppUseContext() {
    const [count, setCount] = useState(0)
    return (
        <div>
            <p>你点击了{count}次。</p>
            <button onClick={() => { setCount(count + 1) }}>点击我</button>
            <CountContext.Provider value={ count }>
                <Counter  />
            </CountContext.Provider>
        </div>
    )
}

export default AppUseContext
```

### 6. useReducer 介绍和简单实用

### 7. useReducer 代替 Redux 1

### 8. useReducer 代替 Redux 2

### 9. useMemo 优化 React Hooks 程序性能

### 10. useRef 获取 DOM 元素和保存变量

### 11. 自定义 Hooks 函数获取窗口大小

## 补充信息

### 1. 数组解构赋值

这种语法叫做“解构赋值”，因为它通过将结构中的各元素复制到变量中来达到“解构”的目的。但 **数组本身是没有被修改的**：

```js
let arr = ['apple', 'pear']

let [a, b] = arr
// 相当于
// let a = arr[0]
// let b = arr[1]

console.log(a, b)  // apple, pear
```

实际上，对象也可以：

```js
let obj = {
    k1: 'apple',
    k2: 'pear'
}

// 方式1：同名
let { k1, k2 } = obj
console.log(k1, k2) // apple, pear

// 方式2：不同名
let { a=k1, b=k2 } = obj
console.log(a, b) // apple, pear
```

### 2. 生命周期函数

<!-- todo -->

## 参考信息

- [Hook 简介 – React](https://zh-hans.reactjs.org/docs/hooks-intro.html)
- [React Hooks 入门教程 \- 阮一峰的网络日志](http://www.ruanyifeng.com/blog/2019/09/react-hooks.html)
- [轻松学会 React 钩子：以 useEffect\(\) 为例 \- 阮一峰的网络日志](http://www.ruanyifeng.com/blog/2020/09/react-hooks-useeffect-tutorial.html)
- [解构赋值 - 现代 JavaScript 教程](https://zh.javascript.info/destructuring-assignment)
- [精读《useEffect 完全指南》](https://juejin.cn/post/6844903806090608647)