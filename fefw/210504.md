# React 学习 - Redux

[toc]

## Todo

- [x] 基础1
- [x] 基础2
- [x] 基础3
- [x] 基础4
- [x] 基础5
- [x] 基础6
- [x] 基础7
- [ ] 基础8
- [ ] 基础9
- [ ] 基础10
- [ ] 基础11
- [ ] 加餐12
- [ ] 进阶13
- [ ] 进阶14
- [ ] 进阶15
- [ ] 进阶16
- [ ] 进阶13
- [ ] 进阶17
- [ ] 进阶18
- [ ] 进阶19
- [ ] 进阶20
- [ ] 进阶21
- [ ] 进阶22
- [ ] 进阶23
- [ ] 加餐24

## 概要信息

- 教程地址：[技术胖 Redux 教程](https://jspang.com/detailed?id=48#toc21)
- 代码仓库地址：[xiezipei/react\-demos](https://github.com/xiezipei/react-demos)

## 教程学习

### 1. Redux 是什么

在 react 基础中可以发现：单纯使用 react 来进行组件通信和状态管理会非常麻烦，比如子组件和父组件通信，要通过父组件的方法来操作。

这就需要引起便捷处理通信方面问题的工具：redux。

why redux？

1. 因为 redux 是目前 react 生态中最好的 **数据层框架**（如何得出该结论？）。

what's redux?

1. redux 是 react 全家桶的一员，它试图为 React 应用提供「可预测化的状态管理」机制
2. Redux 是将整个应用状态存储到到一个地方，称为 `store`
3. 里面保存一棵状态树（`state tree`）
4. 组件可以派发（`dispatch`）行为（`action`）给 store，而不是直接通知其它组件
5. 其它组件可以通过订阅 store 中的状态 `state` 来刷新自己的视图
6. Redux 就是 `Flux` 的升级版本，flux 不建议学

![Xnip2021-05-26_10-25-48](https://tva1.sinaimg.cn/large/008i3skNgy1gqvmbt2nnzj30b305mq35.jpg)

### 2. Redux 工作流程

![Xnip2021-05-26_10-30-39](https://tva1.sinaimg.cn/large/008i3skNgy1gqvmgjreglj30h50cy3zb.jpg)

### 3. 安装 AntD

> 示例程序：demo07

1. 用脚手架快速初始化 `create-react-app demo07`
2. 删除 `src` 里面文件，新建 `index.js` & `TodoList.js`，使用 `imrc`、`ccc` 快速生成模板代码
3. 安装 antd `npm install antd --save`

### 4. 使用 AntD

1. 直接在 TodoList.js 引入 antd css：`import 'antd/dist/antd.css'`
2. 通过 `import { Input } from 'antd'` 引入相关组件

TodoList.js

```js
import React, { Component } from 'react';
import 'antd/dist/antd.css'
import { Input, Button, List } from 'antd'

const data = [
    'do something 1',
    'do something 2',
    'do something 3',
]

class TodoList extends Component {
    render() {
        return (
            <div style={{ margin: '10px' }}>
                <div>
                    <Input placeholder='write someting' style={{ width: '250px', marginRight: '10px' }} />
                    <Button type="primary">增加</Button>
                </div>
                <div style={{ margin: '10px', width: '300px' }}>
                    <List bordered dataSource={data} renderItem={item => (<List.Item>{item}</List.Item>)} />
                </div>
            </div>
        );
    }
}
export default TodoList;
```

### 5. 创建 Redux 仓库中的 store 和 reducer

安装 redux：

```sh
npm install redux --save
```

引入 redux：

1. 在 src 目录新建 store 文件夹
2. store 文件夹：创建文件 `index.js`、`reducer.js`
3. TodoList.js 引入 store/index 中的 store 对象，调用该对象的 `getState()` 方法就获得 `state`，然后把 TodoList 所有模板替换成 `state` 里面的属性，由 redux 统一管理

### 6. 安装 Redux DevTools

仓库地址：[zalmoxisus/redux\-devtools\-extension](https://github.com/zalmoxisus/redux-devtools-extension)

扩展地址：[Redux DevTools \- Chrome 网上应用店](https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd/related?utm_source=chrome-ntp-icon)

引入非常简单，在 store/index 加一行代码：

```js
const store = createStore(
    reducer,
    // 加下面这行代码
    window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()
);
```

### 7. 通过 Input 体验 Redux 流程

结合上面的 redux 工作流程图，大概了解这个过程大概是怎样的了：

首先，input 值改变事件被触发，执行 `dispatch` 动作：

```js
changeInputValue(e) {
    console.log(1, 'changeInputValue'); // => 1
    const action = {
        type: 'change_input_value',
        value: e.target.value
    }
    store.dispatch(action); // 通过 `dispatch()` 方法把数据传递给 `store`
}
```

然后，reducer 处理这个动作：

```js
export default (state = defaultState, action)=>{  //就是一个方法函数
    console.log(2, 'reducer');  // => 2
    // 如果类型正确，传递新状态
    if (action.type === 'changeInput') {
        let newState = JSON.parse(JSON.stringify(state))    // 深拷贝
        newState.InputValue = action.InputValue
        return newState
    }
    // 否则，传递原来状态
    return state
}
```

最后，回到组件，订阅状态变化进行值处理：

```js
constructor(props) {
    super(props)

    // 获取 `state` 对象
    this.state = store.getState()

    // 绑定输入框值变化方法
    this.changeInputValue = this.changeInputValue.bind(this)

    // 转变this指向
    this.storeChange = this.storeChange.bind(this)

    // 订阅 redux 状态
    store.subscribe(this.storeChange)
}

storeChange(){
    console.log(3, 'storeChange');  // => 3
    // 用了组件的 setState 方法
    this.setState(store.getState())
}
```

### 8. 使用 Redux 制作 TodoList 列表

### 9. 使用 Redux 实现 TodoList 的删除功能

### 10. Redux 使用技巧 1

### 11. Redux 使用技巧 2

### 12. Redux 填坑

## 参考信息

1. [react\-redux一点就透](https://juejin.cn/post/6844903602926927880)
2. [React \+ Redux 简介](https://gohalo.me/post/react-redux-introduce.html)